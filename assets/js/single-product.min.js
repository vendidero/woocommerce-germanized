window.germanized=window.germanized||{},function(a,o){o.single_product={params:{},requests:[],productId:0,variationId:0,init:function(){var e=o.single_product;e.params=wc_gzd_single_product_params,e.productId=e.params.product_id,a(e.params.wrapper+" "+e.params.price_selector+":not(.price-unit):visible").on("DOMSubtreeModified",e.onChangePrice),0<a(".variations_form").length&&a(".variations_form").each(function(){var r=a(this);r.on("reset_data",e.onResetVariation),r.on("found_variation.wc-variation-form",e.onFoundVariation)})},onFoundVariation:function(r,e){var i=o.single_product;e.hasOwnProperty("variation_id")&&(i.variationId=e.variation_id)},onResetVariation:function(){o.single_product.variationId=0},getCurrentPriceData:function(){var r=o.single_product,e=a(r.params.wrapper+" "+r.params.price_selector+":not(.price-unit):visible");if(0<e.length){var i=e.parents(r.params.wrapper).find(".price-unit:first"),t=r.getRawPrice(e.find(".amount:first")),n="";if(1<e.find(".amount").length&&(n=r.getRawPrice(e.find(".amount:last"))),0<i.length&&t)return{price:t,unit_price:i,sale_price:n}}return!1},onChangePrice:function(i){setTimeout(function(){var r=o.single_product,e=r.getCurrentPriceData();i.preventDefault(),e&&(a(r.params.wrapper+" "+r.params.price_selector+":not(.price-unit):visible").off("DOMSubtreeModified",r.onChangePrice),0<a.active?r.requests.length<=0&&a(document).on("ajaxStop",r.onAjaxStopRefresh):r.refreshUnitPrice(e.price,e.unit_price,e.sale_price))},500)},onAjaxStopRefresh:function(r){var e=o.single_product,i=e.getCurrentPriceData();i&&e.refreshUnitPrice(i.price,i.unit_price,i.sale_price),a(document).off("ajaxStop",e.onAjaxStopRefresh)},getRawPrice:function(e){var r=o.single_product,i=0<e.length?e.text():"",e=!1;try{e=accounting.unformat(i,r.params.price_decimal_sep)}catch(r){e=!1}return e},refreshUnitPrice:function(r,e,i){var t=o.single_product;if(0<t.requests.length)for(var n=0;n<t.requests.length;n++)t.requests[n].abort();t.requests.push(a.ajax({type:"POST",url:t.params.wc_ajax_url.toString().replace("%%endpoint%%","gzd_refresh_unit_price"),data:{security:t.params.refresh_unit_price_nonce,product_id:0<t.variationId?t.variationId:t.productId,price:r,price_sale:i},success:function(r){r.hasOwnProperty("unit_price_html")&&e.html(r.unit_price_html),a(t.params.wrapper+" "+t.params.price_selector+":not(.price-unit):visible").on("DOMSubtreeModified",t.onChangePrice)},error:function(r){},dataType:"json"}))}},a(document).ready(function(){o.single_product.init()})}(jQuery,window.germanized);