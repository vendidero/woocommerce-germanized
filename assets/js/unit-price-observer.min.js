!function(p,r){function e(e){var a=this;a.$form=e,a.params=wc_gzd_unit_price_observer_params,a.$wrapper=e.closest(a.params.wrapper),a.$product=e.closest(".product"),a.requests=[],a.observer={},a.timeout=!1,a.$wrapper.length<=0&&(a.$wrapper=a.$product),("MutationObserver"in r||"WebKitMutationObserver"in r||"MozMutationObserver"in r)&&(a.$form.addClass("has-unit-price-observer"),a.initObserver(a),e.hasClass("variations_form")?(a.productId=0<e.find("input[name=product_id]").length?e.find("input[name=product_id]").val():e.data("product_id"),a.variationId=0<e.find("input[name=variation_id]").length?e.find("input[name=variation_id]").val():0,e.find("input[name=variation_id]").length<=0&&(a.variationId=0<e.find("input.variation_id").length?e.find("input.variation_id").val():0),e.on("reset_data",{GermanizedUnitPriceObserver:a},a.onResetVariation),e.on("found_variation.wc-variation-form",{GermanizedUnitPriceObserver:a},a.onFoundVariation)):a.productId=0<e.find("*[name=add-to-cart][type=submit]").length?e.find("*[name=add-to-cart][type=submit]").val():a.params.product_id,a.params.refresh_on_load&&p.each(a.params.price_selector,function(t,r){var i=!!r.hasOwnProperty("is_primary_selector")&&r.is_primary_selector,e=a.getPriceNode(a,t,i),n=a.getUnitPriceNode(a,e);0<n.length&&(a.setUnitPriceLoading(a,n),setTimeout(function(){var e=a.getCurrentPriceData(a,t,r.is_total_price,i,r.quantity_selector);e?a.refreshUnitPrice(a,e.price,e.unit_price,e.sale_price,e.quantity):0<n.length&&a.unsetUnitPriceLoading(a,n)},250))}))}e.prototype.getTextWidth=function(e){var t=e.html();e.html("<span>"+t+"</span>");var r=e.find("span:first").width();return e.html(t),r},e.prototype.getPriceNode=function(e,t,r){r=void 0!==r&&r;t=e.$wrapper.find(t+":not(.price-unit):visible:last");return t=r&&t.length<=0&&e.$form.hasClass("variations_form")?e.$wrapper.find(".woocommerce-variation-price span.price:not(.price-unit):visible:last"):t},e.prototype.getUnitPriceNode=function(e,t){return t.length<=0?[]:t.parents(e.params.wrapper).find(".price-unit:not(.wc-gzd-additional-info-placeholder, .wc-gzd-additional-info-loop)")},e.prototype.initObserver=function(c){0===Object.keys(c.observer).length&&p.each(c.params.price_selector,function(n,a){var e,o=!!a.hasOwnProperty("is_primary_selector")&&a.is_primary_selector,s=c.getPriceNode(c,n,o),t=!1;0<s.length&&(e=function(e,t){c.timeout&&(clearTimeout(c.timeout),c.abortAjaxRequests(c));var r=c.getUnitPriceNode(c,s),i=!1;0<r.length&&c.setUnitPriceLoading(c,r),c.timeout=setTimeout(function(){var e=c.getCurrentPriceData(c,n,a.is_total_price,o,a.quantity_selector);e&&p.active<=0&&(i=!0,c.refreshUnitPrice(c,e.price,e.unit_price,e.sale_price,e.quantity)),!i&&0<r.length&&c.unsetUnitPriceLoading(c,r)},500)},"MutationObserver"in r?t=new r.MutationObserver(e):"WebKitMutationObserver"in r?t=new r.WebKitMutationObserver(e):"MozMutationObserver"in r&&(t=new r.MozMutationObserver(e)),t&&(c.observer[n]=t,c.observer[n].observe(s[0],{childList:!0,subtree:!0,characterData:!0})))})},e.prototype.cancelObserver=function(e){if(0<e.observer.length)for(var t in e.observer)e.observer.hasOwnProperty(t)&&(e.observer[t].disconnect(),delete e.observer[t])},e.prototype.abortAjaxRequests=function(e){if(0<e.requests.length)for(var t=0;t<e.requests.length;t++)e.requests[t].abort()},e.prototype.onResetVariation=function(e){e.data.GermanizedUnitPriceObserver.variationId=0},e.prototype.onFoundVariation=function(e,t){e=e.data.GermanizedUnitPriceObserver;t.hasOwnProperty("variation_id")&&(e.variationId=t.variation_id),e.initObserver(e)},e.prototype.getCurrentPriceData=function(e,t,r,i,n){n=n&&""!==n?n:e.params.qty_selector;var a=e.getPriceNode(e,t,i);if(0<a.length){var o=e.getUnitPriceNode(e,a),s=a.clone();s.find(".woocommerce-price-suffix").remove();t="",i=s.find(".amount:first"),a=p(e.params.wrapper+" "+n+":first"),n=1;0<a.length&&(n=parseFloat(a.val())),i.length<=0&&(i=0<s.find(".price").length?s.find(".price"):s);i=e.getRawPrice(i,e.params.price_decimal_sep);if(1<s.find(".amount").length&&(s=p(s.find(".amount")[1]),t=e.getRawPrice(s,e.params.price_decimal_sep)),0<o.length&&i)return r&&(i=parseFloat(i)/n,0<t.length&&(t=parseFloat(t)/n)),{price:i,unit_price:o,sale_price:t,quantity:n}}return!1},e.prototype.getCurrentProductId=function(e){var t=e.productId;return 0<e.variationId&&(t=e.variationId),parseInt(t)},e.prototype.getRawPrice=function(t,e){var r=0<t.length?t.text():"",t=!1;try{t=accounting.unformat(r,e)}catch(e){t=!1}return t},e.prototype.setUnitPriceLoading=function(e,t){var r,i=t.html();return t.hasClass("wc-gzd-loading")?i=t.data("org-html"):(r=e.getTextWidth(t),e=0<t.find("span").length?t.find("span").innerHeight():t.height(),t.html('<span class="wc-gzd-placeholder-loading"><span class="wc-gzd-placeholder-row" style="height: '+t.height()+'px;"><span class="wc-gzd-placeholder-row-col-4" style="width: '+r+"px; height: "+e+'px;"></span></span></span>'),t.addClass("wc-gzd-loading"),t.data("org-html",i)),i},e.prototype.unsetUnitPriceLoading=function(e,t,r){r=r||t.data("org-html"),t.hasClass("wc-gzd-loading")&&(t.html(r),t.removeClass("wc-gzd-loading").show())},e.prototype.refreshUnitPrice=function(t,e,r,i,n){t.abortAjaxRequests(t);t.setUnitPriceLoading(t,r);t.requests.push(p.ajax({type:"POST",url:t.params.wc_ajax_url.toString().replace("%%endpoint%%","gzd_refresh_unit_price"),data:{security:t.params.refresh_unit_price_nonce,product_id:t.getCurrentProductId(t),price:e,price_sale:i,quantity:n},success:function(e){parseInt(e.product_id)===t.getCurrentProductId(t)&&e.hasOwnProperty("unit_price_html")?t.unsetUnitPriceLoading(t,r,e.unit_price_html):t.unsetUnitPriceLoading(t,r)},error:function(e){t.unsetUnitPriceLoading(t,r)},dataType:"json"}))},p.fn.wc_germanized_unit_price_observer=function(){return new e(this),this},p(function(){"undefined"!=typeof wc_gzd_unit_price_observer_params&&p(".variations_form, "+wc_gzd_unit_price_observer_params.wrapper+" form.cart").each(function(){p(this).wc_germanized_unit_price_observer()})})}(jQuery,window,document),window.germanized=window.germanized||{};