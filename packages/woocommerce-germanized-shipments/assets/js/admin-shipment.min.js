window.germanized=window.germanized||{},window.germanized.admin=window.germanized.admin||{},function(n){n.GermanizedShipment=function(t){this.vars={$shipment:!1,params:{},id:"",isEditable:!0,needsItems:!0},(this.root=this).construct=function(t){this.vars.id=t,this.vars.params=germanized.admin.shipments.getParams(),this.refreshDom(),n(document.body).on("wc_backbone_modal_loaded",this.backbone.init.bind(this)).on("wc_backbone_modal_response",this.backbone.response.bind(this))},this.refreshDom=function(){this.vars.$shipment=n("#order-shipments-list").find("#shipment-"+this.getId()),this.setNeedsItems(this.vars.$shipment.hasClass("needs-items")),this.setIsEditable(this.vars.$shipment.hasClass("is-editable")),this.onChangeProvider(),n("#shipment-"+this.vars.id+" #shipment-items-"+this.vars.id).off(),n("#shipment-"+this.vars.id+" #shipment-footer-"+this.vars.id).off(),n("#shipment-"+this.vars.id+" #shipment-shipping-provider-"+this.vars.id).off(),n("#shipment-"+this.vars.id+" #shipment-packaging-"+this.vars.id).off(),n("#shipment-"+this.vars.id+" .wc-gzd-shipment-label").off(),n("#shipment-"+this.vars.id+" #shipment-shipping-provider-"+this.vars.id).on("change",this.onChangeProvider.bind(this)),n("#shipment-"+this.vars.id+" #shipment-packaging-"+this.vars.id).on("change",this.refreshDimensions.bind(this)),n("#shipment-"+this.vars.id+" #shipment-items-"+this.vars.id).on("change",".item-quantity",this.onChangeQuantity.bind(this)).on("click","a.remove-shipment-item",this.onRemoveItem.bind(this)).on("click","a.add-shipment-item",this.onAddItem.bind(this)).on("click","a.sync-shipment-items",this.onSyncItems.bind(this)),n("#shipment-"+this.vars.id+" #shipment-footer-"+this.vars.id).on("click",".send-return-shipment-notification",this.onSendReturnNotification.bind(this)).on("click",".confirm-return-shipment",this.onConfirmReturnRequest.bind(this)),n("#shipment-"+this.vars.id+" .wc-gzd-shipment-label").on("click",".create-shipment-label:not(.disabled)",this.onCreateLabel.bind(this)).on("click",".remove-shipment-label",this.onRemoveLabel.bind(this))},this.refreshDimensions=function(){var t=this.getShipment(),i=t.find("#shipment-packaging-"+this.getId()).find("option:selected");""===i.val()?(t.find("#shipment-length-"+this.getId()).removeClass("disabled").prop("disabled",!1),t.find("#shipment-length-"+this.getId()).val(""),t.find("#shipment-width-"+this.getId()).removeClass("disabled").prop("disabled",!1),t.find("#shipment-width-"+this.getId()).val(""),t.find("#shipment-height-"+this.getId()).removeClass("disabled").prop("disabled",!1),t.find("#shipment-height-"+this.getId()).val("")):(t.find("#shipment-length-"+this.getId()).addClass("disabled").prop("disabled",!0),t.find("#shipment-length-"+this.getId()).val(i.data("length")),t.find("#shipment-width-"+this.getId()).addClass("disabled").prop("disabled",!0),t.find("#shipment-width-"+this.getId()).val(i.data("width")),t.find("#shipment-height-"+this.getId()).addClass("disabled").prop("disabled",!0),t.find("#shipment-height-"+this.getId()).val(i.data("height")))},this.blockPackaging=function(){this.getShipmentContent().find(".wc-gzd-shipment-packaging-wrapper").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},this.unblockPackaging=function(){this.getShipmentContent().find(".wc-gzd-shipment-packaging-wrapper").unblock()},this.refreshPackaging=function(){var t={action:"woocommerce_gzd_refresh_shipment_packaging",shipment_id:this.getId(),security:germanized.admin.shipments.getParams().refresh_packaging_nonce};this.blockPackaging(),germanized.admin.shipments.doAjax(t,this.unblockPackaging.bind(this),this.unblockPackaging.bind(this))},this.onSendReturnNotification=function(){var t={action:"woocommerce_gzd_send_return_shipment_notification_email",shipment_id:this.getId(),security:germanized.admin.shipments.getParams().send_return_notification_nonce};return this.block(),germanized.admin.shipments.doAjax(t,this.unblock.bind(this),this.unblock.bind(this)),!1},this.onConfirmReturnRequest=function(){var t={action:"woocommerce_gzd_confirm_return_request",shipment_id:this.getId(),security:germanized.admin.shipments.getParams().confirm_return_request_nonce};return this.block(),germanized.admin.shipments.doAjax(t,this.unblock.bind(this),this.unblock.bind(this)),!1},this.onRemoveLabel=function(){return window.confirm(germanized.admin.shipments.getParams().i18n_remove_label_notice)&&this.removeLabel(),!1},this.removeLabel=function(){var t={action:"woocommerce_gzd_remove_shipment_label",shipment_id:this.getId(),security:germanized.admin.shipments.getParams().remove_label_nonce};this.block(),germanized.admin.shipments.doAjax(t,this.unblock.bind(this),this.unblock.bind(this))},this.onCreateLabel=function(){return this.getShipment().WCBackboneModal({template:"wc-gzd-modal-create-shipment-label-"+this.getId()}),!1},this.onChangeProvider=function(){var t=this.getShipment(),i=t.find("#shipment-shipping-provider-"+this.getId()),e=i.find("option:selected");t.find(".show-if-provider").hide(),0<e.length&&e.data("is-manual")&&"yes"===e.data("is-manual")&&t.find(".show-if-provider-is-manual").show(),t.find(".show-if-provider-"+i.val()).show()},this.getShipment=function(){return this.vars.$shipment},this.getShipmentContent=function(){return this.vars.$shipment.find("> .shipment-content-wrapper > .shipment-content > .columns > div:not(.shipment-returns-data)")},this.onChangeQuantity=function(t){var t=n(t.target),i=t.parents(".shipment-item").data("id"),t=t.val(),i=(this.blockItems(),{action:"woocommerce_gzd_limit_shipment_item_quantity",shipment_id:this.getId(),item_id:i,quantity:t});germanized.admin.shipments.doAjax(i,this.onChangeQuantitySuccess.bind(this))},this.onChangeQuantitySuccess=function(t){var i=this.getShipment().find('.shipment-item[data-id="'+t.item_id+'"]'),e=i.find(".item-quantity").val(),t=t.max_quantity;t<e?i.find(".item-quantity").val(t):e<=0&&i.find(".item-quantity").val(1),this.refreshDom(),this.unblockItems()},this.setWeight=function(t){this.getShipment().find("#shipment-weight-"+this.getId()).attr("placeholder",t)},this.setLength=function(t){this.getShipment().find("#shipment-length-"+this.getId()).attr("placeholder",t)},this.setWidth=function(t){this.getShipment().find("#shipment-width-"+this.getId()).attr("placeholder",t)},this.setHeight=function(t){this.getShipment().find("#shipment-height-"+this.getId()).attr("placeholder",t)},this.setTotalWeight=function(t){},this.setIsEditable=function(t){var e=this;this.vars.isEditable=!0===(t="boolean"!=typeof t?!0:t),this.vars.isEditable?(this.getShipment().addClass("is-editable"),this.getShipment().removeClass("is-locked"),this.getShipmentContent().find(".remove-shipment-item ").show(),this.getShipmentContent().find(".shipment-item-actions").show(),this.getShipmentContent().find(":input:not(.disabled):not([type=hidden])").prop("disabled",!1)):(this.getShipment().removeClass("is-editable"),this.getShipment().addClass("is-locked"),this.getShipmentContent().find(".remove-shipment-item ").hide(),this.getShipmentContent().find(".shipment-item-actions").hide(),this.getShipmentContent().find(":input:not([type=hidden])").prop("disabled",!0),n.each(this.vars.params.shipment_locked_excluded_fields,function(t,i){e.getShipmentContent().find(":input[name^=shipment_"+i+"]").prop("disabled",!1)}))},this.setNeedsItems=function(t){this.vars.needsItems=!0===(t="boolean"!=typeof t?!0:t),this.vars.needsItems?this.getShipment().addClass("needs-items"):this.getShipment().removeClass("needs-items")},this.onSyncItems=function(){return this.syncItems(),!1},this.syncItems=function(){this.blockItems();var t={action:"woocommerce_gzd_sync_shipment_items",shipment_id:this.getId()};germanized.admin.shipments.doAjax(t,this.onSyncItemsSuccess.bind(this),this.onSyncItemsError.bind(this))},this.onSyncItemsSuccess=function(t){this.unblockItems()},this.onSyncItemsError=function(t){this.unblockItems()},this.onAddItem=function(){return this.getShipment().WCBackboneModal({template:"wc-gzd-modal-add-shipment-item-"+this.getId()}),!1},this.addItem=function(t,i){i=i||1,this.blockItems();t={action:"woocommerce_gzd_add_shipment_item",shipment_id:this.getId(),original_item_id:t,quantity:i};germanized.admin.shipments.doAjax(t,this.onAddItemSuccess.bind(this),this.onAddItemError.bind(this))},this.addReturn=function(t){this.block();var i={action:"woocommerce_gzd_add_shipment_return",shipment_id:this.getId()};n.extend(i,t),germanized.admin.shipments.doAjax(i,this.onAddReturnSuccess.bind(this),this.onAddReturnError.bind(this))},this.onAddReturnSuccess=function(t){this.getShipment().find(".shipment-return-list").append(t.new_shipment),this.refreshDom(),germanized.admin.shipments.initShipments(),this.unblock()},this.onAddReturnError=function(t){this.unblock()},this.onAddItemError=function(t){this.unblockItems()},this.onAddItemSuccess=function(t){this.getShipmentContent().find(".shipment-item-list").append(t.new_item),this.refreshDom(),this.unblockItems()},this.onRemoveItem=function(t){var t=n(t.target).parents(".shipment-item"),i=t.data("id");return 0<t.length&&this.removeItem(i),!1},this.blockItems=function(){this.getShipmentContent().find(".shipment-items").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},this.block=function(){this.getShipment().block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},this.unblockItems=function(){this.getShipmentContent().find(".shipment-items").unblock()},this.unblock=function(){this.getShipment().unblock()},this.removeItem=function(t){this.getShipment().find('.shipment-item[data-id="'+t+'"]');t={action:"woocommerce_gzd_remove_shipment_item",shipment_id:this.getId(),item_id:t};this.blockItems(),germanized.admin.shipments.doAjax(t,this.onRemoveItemSuccess.bind(this))},this.onRemoveItemSuccess=function(t){t=this.getShipment().find('.shipment-item[data-id="'+t.item_id+'"]');0<t.length&&t.slideUp(150,function(){n(this).remove()}),this.unblockItems()},this.getId=function(){return this.vars.id},this.backbone={onAddItemSuccess:function(t){$select=n("select#wc-gzd-shipment-add-items-select"),($quantity=n("input#wc-gzd-shipment-add-items-quantity")).val(1),n.each(t.items,function(t,i){$select.append('<option value="'+t+'">'+i.name+"</option>"),$quantity.data("max-quantity-"+t,i.max_quantity)}),n(".wc-backbone-modal-content article").unblock(),n(document.body).on("change","input#wc-gzd-shipment-add-items-quantity",function(){var t=$select.val(),i=n(this).val();$quantity.data("max-quantity-"+t)&&(t=$quantity.data("max-quantity-"+t))<i&&$quantity.val(t)})},init:function(t,i){var e=this.getId();if("wc-gzd-modal-add-shipment-item-"+e===i)return n(".wc-backbone-modal-content article").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),germanized.admin.shipments.doAjax({action:"woocommerce_gzd_get_available_shipment_items",shipment_id:e},this.backbone.onAddItemSuccess.bind(this)),!1},response:function(t,i,e){"wc-gzd-modal-add-shipment-item-"+this.getId()===i&&this.addItem(e.item_id,e.item_qty)}},this.construct(t)}}(jQuery,window.germanized.admin);