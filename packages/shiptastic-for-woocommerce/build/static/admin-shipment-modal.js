window.shiptastic=window.shiptastic||{},window.shiptastic.admin=window.shiptastic.admin||{},function(t,a,o,i){var n=function(e){var a=this;a.params=wc_shiptastic_admin_shipment_modal_params,a.$modalTrigger=e,a.destroy(),a.setup(),a.$modalTrigger.on("click.wc-stc-modal-"+a.modalId,{adminShipmentModal:a},a.onClick),t(o.body).on("wc_backbone_modal_loaded.wc-stc-modal-"+a.modalId,{adminShipmentModal:a},a.onOpen).on("wc_backbone_modal_response.wc-stc-modal-"+a.modalId,{adminShipmentModal:a},a.response).on("wc_backbone_modal_before_remove.wc-stc-modal-"+a.modalId,{adminShipmentModal:a},a.onClose)};n.prototype.setup=function(){var t=this;t.referenceId=t.$modalTrigger.data("reference")?t.$modalTrigger.data("reference"):0,t.modalClass=t.$modalTrigger.data("id"),t.modalId=t.modalClass+"-"+t.referenceId,t.loadAsync=!!t.$modalTrigger.data("load-async")&&t.$modalTrigger.data("load-async"),t.nonceParams=t.$modalTrigger.data("nonce-params")?t.$modalTrigger.data("nonce-params"):"wc_shiptastic_admin_shipments_params",t.$modal=!1,t.$modalTrigger.data("self",this)},n.prototype.destroy=function(){var e=this;e.$modalTrigger.off(".wc-stc-modal-"+e.modalId),t(o).off(".wc-stc-modal-"+e.modalId),t(o.body).off(".wc-stc-modal-"+e.modalId)},n.prototype.getShipment=function(e){return t("#panel-order-shipments").find("#shipment-"+e)},n.prototype.onRemoveNotice=function(e){return e.data.adminShipmentModal,t(this).parents(".notice").slideUp(150,(function(){t(this).remove()})),!1},n.prototype.onClick=function(t){var e=t.data.adminShipmentModal;return e.$modalTrigger.WCBackboneModal({template:e.modalId}),!1},n.prototype.parseFieldId=function(t){return t.replace("[","_").replace("]","")},n.prototype.onExpandMore=function(e){var a=e.data.adminShipmentModal,o=a.$modal.find(".show-more-wrapper"),i=t(this).parents(".show-more-trigger");return o.show(),o.find(":input:visible").trigger("change",[a]),i.find(".show-more").hide(),i.find(".show-fewer").show(),!1},n.prototype.onHideMore=function(e){var a=e.data.adminShipmentModal.$modal.find(".show-more-wrapper"),o=t(this).parents(".show-more-trigger");return a.hide(),o.find(".show-further-services").show(),o.find(".show-fewer-services").hide(),!1},n.prototype.onChangeField=function(e){var a=e.data.adminShipmentModal,i=a.$modal,n=a.parseFieldId(t(this).attr("id")),r=t(this).val();if(t(this).attr("max")){var d=t(this).attr("max");r>d&&t(this).val(d)}if(t(this).attr("min")){var s=t(this).attr("min");r<s&&t(this).val(s)}if(t(this).hasClass("show-if-trigger")){var m=i.find(t(this).data("show-if"));m.length>0&&(t(this).is(":checked")?m.show():m.hide(),t(o.body).trigger("wc_shiptastic_admin_shipment_modal_show_if",[a]),a.$modalTrigger.trigger("wc_shiptastic_admin_shipment_modal_show_if",[a]))}else i.find(":input[data-show-if-"+n+"]").parents(".form-field").hide(),t(this).is(":visible")&&(t(this).is(":checkbox")?t(this).is(":checked")&&i.find(":input[data-show-if-"+n+"]").parents(".form-field").show():("0"!==r&&""!==r&&i.find(":input[data-show-if-"+n+'=""]').parents(".form-field").show(),i.find(":input[data-show-if-"+n+'*="'+r+'"]').parents(".form-field").show())),i.find(":input[data-show-if-"+n+"]").trigger("change"),a.showMoreWrapper()},n.prototype.showMoreWrapper=function(){var e=this.$modal;e.find(".show-more-wrapper").each((function(){var a=t(this),o=a.find("p.form-field").filter((function(){return"none"!==this.style.display})),i=!!a.data("trigger")&&e.find(a.data("trigger"));i.length>0&&(o.length<=0?i.hide():i.show())}))},n.prototype.onClose=function(t,e){var a=t.data.adminShipmentModal;-1!==e.indexOf(a.modalId)&&a.$modal&&a.$modal.length>0&&a.$modal.off("click.wc-stc-modal-"+a.modalId)},n.prototype.onOpen=function(e,a){var i=e.data.adminShipmentModal;-1!==a.indexOf(i.modalId)&&(i.setup(),i.$modal=t("."+i.modalClass),i.$modal.data("self",i),i.loadAsync?(params={action:i.getAction("load"),reference_id:i.referenceId,security:i.getNonce("load")},i.doAjax(params,i.onLoadSuccess)):i.initData(),t(o.body).trigger("wc_shiptastic_admin_shipment_modal_open",[i]),i.$modalTrigger.trigger("wc_shiptastic_admin_shipment_modal_open",[i]))},n.prototype.onLoadSuccess=function(e,a){a.initData(),t(o.body).trigger("wc_shiptastic_admin_shipment_modal_after_load_success",[e,a]),a.$modalTrigger.trigger("wc_shiptastic_admin_shipment_modal_after_load_success",[e,a])},n.prototype.onAjaxSuccess=function(t,e){},n.prototype.onAjaxError=function(t,e){},n.prototype.getModalMainContent=function(){return this.$modal.find("article")},n.prototype.doAjax=function(e,a,n){var r=this,d=r.getModalMainContent();a=a||r.onAjaxSuccess,n=n||r.onAjaxError,e.hasOwnProperty("reference_id")||(e.reference_id=r.referenceId),r.$modal.find(".wc-backbone-modal-content").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),r.$modal.find(".notice-wrapper").empty(),t.ajax({type:"POST",url:r.params.ajax_url,data:e,success:function(e){e.success?(e.fragments&&t.each(e.fragments,(function(e,a){t(e).replaceWith(a)})),r.$modal.find("#btn-ok").prop("disabled",!1),r.$modal.find(".wc-backbone-modal-content").unblock(),a.apply(r,[e,r]),i.admin.shipments&&i.admin.shipments.refresh(e),t(o.body).trigger("wc_shiptastic_admin_shipment_modal_ajax_success",[e,r]),r.$modalTrigger.trigger("wc_shiptastic_admin_shipment_modal_ajax_success",[e,r]),e.fragments&&r.afterRefresh()):(r.$modal.find("#btn-ok").prop("disabled",!1),r.$modal.find(".wc-backbone-modal-content").unblock(),n.apply(r,[e,r]),r.printNotices(d,e),d.animate({scrollTop:0},500),t(o.body).trigger("wc_shiptastic_admin_shipment_modal_ajax_error",[e,r]),r.$modalTrigger.trigger("wc_shiptastic_admin_shipment_modal_ajax_error",[e,r]))},error:function(t){},dataType:"json"})},n.prototype.afterRefresh=function(){0===this.$modal.find(".notice-wrapper").length&&this.getModalMainContent().prepend('<div class="notice-wrapper"></div>'),t(o.body).trigger("wc-enhanced-select-init"),t(o.body).trigger("wc-init-datepickers"),t(o.body).trigger("init_tooltips")},n.prototype.initData=function(){var e=this;e.$modal=t("."+e.modalClass),e.$modal.data("self",e),e.afterRefresh(),e.$modal.on("click.wc-stc-modal-"+e.modalId,"#btn-ok",{adminShipmentModal:e},e.onSubmit),e.$modal.on("touchstart.wc-stc-modal-"+e.modalId,"#btn-ok",{adminShipmentModal:e},e.onSubmit),e.$modal.on("keydown.wc-stc-modal-"+e.modalId,{adminShipmentModal:e},e.onKeyDown),e.$modal.on("click.wc-stc-modal-"+e.modalId,".notice .notice-dismiss",{adminShipmentModal:e},e.onRemoveNotice),e.$modal.on("change.wc-stc-modal-"+e.modalId,":input[id]",{adminShipmentModal:e},e.onChangeField),e.$modal.on("click.wc-stc-modal-"+e.modalId,".show-more",{adminShipmentModal:e},e.onExpandMore),e.$modal.on("click.wc-stc-modal-"+e.modalId,".show-fewer",{adminShipmentModal:e},e.onHideMore),t(o.body).trigger("wc_shiptastic_admin_shipment_modal_after_init_data",[e]),e.$modalTrigger.trigger("wc_shiptastic_admin_shipment_modal_after_init_data",[e]),e.$modal.find(":input:visible").trigger("change",[e])},n.prototype.printNotices=function(e,a){var o=this;a.hasOwnProperty("message")?o.addNotice(a.message,"error",e):a.hasOwnProperty("messages")&&t.each(a.messages,(function(a,i){"string"==typeof i||i instanceof String?o.addNotice(i,"error",e):t.each(i,(function(t,i){o.addNotice(i,"soft"===a?"warning":a,e)}))}))},n.prototype.onSubmitSuccess=function(e,a){var n=a.getModalMainContent();e.hasOwnProperty("messages")&&(e.messages.hasOwnProperty("error")||e.messages.hasOwnProperty("soft"))?(a.printNotices(n,e),a.$modal.find("footer").find("#btn-ok").addClass("modal-close").attr("id","btn-close").text(a.params.i18n_modal_close)):a.$modal.find(".modal-close").trigger("click"),e.hasOwnProperty("shipment_id")&&t("div#shipment-"+e.shipment_id).length>0&&i.admin.shipments.initShipment(e.shipment_id),t(o.body).trigger("wc_shiptastic_admin_shipment_modal_after_submit_success",[e,a]),a.$modalTrigger.trigger("wc_shiptastic_admin_shipment_modal_after_submit_success",[e,a])},n.prototype.getCleanId=function(t=!1){var e=this.modalClass.split("-").join("_").replace("_modal_","_");return t&&(e=e.replace("wc_stc_","").replace("wc_gzdp_","")),e},n.prototype.getNonceParams=function(){return a.hasOwnProperty(this.nonceParams)?a[this.nonceParams]:{}},n.prototype.getNonce=function(t){var e=this.getCleanId(!0)+"_"+t+"_nonce",a=this.getNonceParams();return a.hasOwnProperty(e)?a[e]:this.params[t+"_nonce"]},n.prototype.getAction=function(t){return this.getCleanId().replace("wc_","woocommerce_")+"_"+t},n.prototype.onKeyDown=function(t){var a=t.data.adminShipmentModal;13!==(t.keyCode||t.which)||t.target.tagName&&("input"===t.target.tagName.toLowerCase()||"textarea"===t.target.tagName.toLowerCase())||a.onSubmit.apply(a.$modal.find("button#btn-ok"),[e])},n.prototype.getFormData=function(e){var a={};return e.find(".show-more-wrapper").each((function(){t(this).is(":visible")||t(this).addClass("show-more-wrapper-force-show").show()})),t.each(e.find(":input").serializeArray(),(function(o,i){var n=e.find(':input[name="'+i.name+'"]');if(n&&!n.is(":visible")&&"hidden"!==n.attr("type"))return!0;-1!==i.name.indexOf("[]")?(i.name=i.name.replace("[]",""),a[i.name]=t.makeArray(a[i.name]),a[i.name].push(i.value)):a[i.name]=i.value})),e.find(".show-more-wrapper-force-show").each((function(){t(this).removeClass("show-more-wrapper-force-show").hide()})),a},n.prototype.onSubmit=function(t){var e=t.data.adminShipmentModal,a=e.getModalMainContent().find("form"),o=e.getFormData(a),i=e.$modal.find("#btn-ok");i.length>0&&i.prop("disabled",!0),o.security=e.getNonce("submit"),o.reference_id=e.referenceId,o.action=e.getAction("submit"),e.doAjax(o,e.onSubmitSuccess),t.preventDefault(),t.stopPropagation()},n.prototype.addNotice=function(t,e,a){a.find(".notice-wrapper").append('<div class="notice is-dismissible notice-'+e+'"><p>'+t+'</p><button type="button" class="notice-dismiss"></button></div>')},n.prototype.response=function(e,a,i){var n=e.data.adminShipmentModal;-1!==a.indexOf(n.modalId)&&(t(o.body).trigger("wc_shiptastic_admin_shipment_modal_response",[n,i]),n.$modalTrigger.trigger("wc_shiptastic_admin_shipment_modal_response",[n,i]))},t.fn.wc_shiptastic_admin_shipment_modal=function(){return this.each((function(){return new n(t(this)),this}))}}(jQuery,window,document,window.shiptastic),((window.wcShiptastic=window.wcShiptastic||{}).static=window.wcShiptastic.static||{})["admin-shipment-modal"]={};