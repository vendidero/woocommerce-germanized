(()=>{var i,c;window.shiptastic=window.shiptastic||{},window.shiptastic.shipments_pickup_locations=window.shiptastic.shipments_pickup_locations||{},i=jQuery,(c=window.shiptastic).shipments_pickup_locations={params:{},pickupLocations:{},available:!1,currentProvider:"",init:function(){var t=c.shipments_pickup_locations;t.params=wc_shiptastic_pickup_locations_params;var o=t.getPickupLocationSelect();if(o.length>0){if(o.attr("data-locations"))try{t.pickupLocations=JSON.parse(o.attr("data-locations"))}catch(i){t.pickupLocations={}}o.attr("data-provider")&&(t.currentProvider=o.attr("data-provider"))}i("#current_pickup_location").length>0&&(t.available=i(".choose-pickup-location:visible").length>0||i(".currently-shipping-to:visible").length>0,i(document.body).on("updated_checkout",t.afterRefreshCheckout),i(document).on("change","#ship-to-different-address-checkbox",t.onSelectDifferentShipping),i(document).on("submit","#wc-shiptastic-pickup-location-search-form",t.onSearch),i(document).on("click",".submit-pickup-location",t.onSelectPickupLocation),i(document).on("change","#current_pickup_location",t.onChangeCurrentPickupLocation),i(document).on("click",".pickup-location-remove",t.onRemovePickupLocation),i(document).on("change","#pickup_location",t.onChangePickupLocation),i(document).on("change","#billing_postcode, #shipping_postcode",t.onChangeAddress),t.onChangeCurrentPickupLocation(),t.onChangePickupLocation(),t.maybeInitSelect2())},onChangeAddress:function(){c.shipments_pickup_locations;var t=i("#shipping_postcode:visible").val()?i("#shipping_postcode:visible").val():i("#billing_postcode").val();i("#pickup-location-postcode").val(t)},onChangePickupLocation:function(){c.shipments_pickup_locations.getPickupLocationSelect().val()?i(".pickup-location-search-actions").find(".submit-pickup-location").removeClass("hidden").show():i(".pickup-location-search-actions").find(".submit-pickup-location").addClass("hidden").hide()},hasPickupLocationDelivery:function(){return c.shipments_pickup_locations,!!i("#current_pickup_location").val()},disablePickupLocationDelivery:function(t=!1){var o=c.shipments_pickup_locations,e=i('.wc-stc-modal-content[data-id="pickup-location"].active');if(i(".wc-shiptastic-managed-by-pickup-location").val(""),i("#current_pickup_location").val("").trigger("change"),e.length>0&&e.find(".wc-stc-modal-close").trigger("click"),t){var a=i("form.checkout");a.find(".woocommerce-NoticeGroup-updateOrderReview").length<=0&&a.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-updateOrderReview"></div>'),a.find(".woocommerce-NoticeGroup-updateOrderReview").prepend('<div class="woocommerce-info">'+o.params.i18n_pickup_location_delivery_unavailable+"</div>");var n=i(".woocommerce-NoticeGroup-updateOrderReview");i.scroll_to_notices(n)}},onRemovePickupLocation:function(){return c.shipments_pickup_locations.disablePickupLocationDelivery(),!1},getCustomerNumberField:function(){return i("#pickup_location_customer_number_field")},onChangeCurrentPickupLocation:function(){var t=c.shipments_pickup_locations,o=i("#current_pickup_location"),e=o.val(),a=!!e&&t.getPickupLocation(e),n=i(".pickup_location_notice");e&&a?(o.attr("data-current-location",JSON.stringify(a)),t.replaceShippingAddress(a.address_replacements),t.updateCustomerNumberField(a),n.find(".pickup-location-manage-link").text(a.label),n.find(".currently-shipping-to").show(),n.find(".choose-pickup-location").hide(),i("#wc-shiptastic-pickup-location-search-form .pickup-location-remove").removeClass("hidden").show()):(o.attr("data-current-location",""),o.val(""),t.getCustomerNumberField().addClass("hidden"),t.getCustomerNumberField().hide(),i(".wc-shiptastic-managed-by-pickup-location").find("input[type=text]").val(""),i(".wc-shiptastic-managed-by-pickup-location").find(":input").prop("readonly",!1),i("#wc-shiptastic-pickup-location-search-form .pickup-location-remove").addClass("hidden").hide(),i(".wc-shiptastic-managed-by-pickup-location").removeClass("wc-shiptastic-managed-by-pickup-location"),i(".wc-shiptastic-managed-by-pickup-location-notice").remove(),n.find(".currently-shipping-to").hide(),n.find(".choose-pickup-location").show())},onSearch:function(){var t=c.shipments_pickup_locations,o=i(this).serialize(),e=(t.getPickupLocationSelect().val(),t.pickupLocations);return i("#wc-shiptastic-pickup-location-search-form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o+="&action=woocommerce_stc_search_pickup_locations&context="+t.params.context,i.ajax({type:"POST",url:t.params.wc_ajax_url.toString().replace("%%endpoint%%","woocommerce_stc_search_pickup_locations"),data:o,success:function(c){c.success&&(t.pickupLocations=c.locations,t.updatePickupLocationSelect(e),i("#wc-shiptastic-pickup-location-search-form").unblock())},error:function(i){},dataType:"json"}),!1},updatePickupLocationSelect:function(t=[]){var o=c.shipments_pickup_locations,e=o.getPickupLocationSelect(),a=e.val();try{e.attr("data-locations",JSON.stringify(o.pickupLocations))}catch(i){}e.find('option:not([value=""])').remove(),i.each(o.pickupLocations,(function(c,t){var o=i("<textarea />").html(t.formatted_address).text();e.append(i("<option></option>").attr("value",c).text(o))}));var n=o.getPickupLocation(a,!1);n&&(e.find('option[value="'+n.code+'"')[0].selected=!0);try{JSON.stringify(o.pickupLocations)!==JSON.stringify(t)&&e.trigger("change")}catch(i){}},onSelectDifferentShipping:function(){var t=c.shipments_pickup_locations;i(this).is(":checked")?i("#billing_pickup_location_notice").addClass("hidden").hide():(t.disablePickupLocationDelivery(),t.isAvailable()&&i("#billing_pickup_location_notice").removeClass("hidden").show())},maybeInitSelect2:function(){i().selectWoo&&i("select#pickup_location").each((function(){var c=i(this),t={placeholder:c.attr("data-placeholder")||c.attr("placeholder")||"",label:c.attr("data-label")||null,width:"100%",dropdownCssClass:"wc-stc-pickup-location-select-dropdown"};i(this).on("select2:select",(function(){i(this).trigger("focus")})).selectWoo(t)}))},onSelectPickupLocation:function(){var t=c.shipments_pickup_locations.getPickupLocationSelect().val();i("#current_pickup_location").val(t).trigger("change"),i(this).parents(".wc-stc-modal-content").find(".wc-stc-modal-close").trigger("click");var o=i("#shipping_address_1_field");return i.scroll_to_notices(o),!1},updateCustomerNumberField:function(i){var t=c.shipments_pickup_locations.getCustomerNumberField();i.supports_customer_number?(t.find("label")[0].firstChild.nodeValue=i.customer_number_field_label+" ",i.customer_number_is_mandatory?(t.find("label .required").length||t.find("label").append(' <abbr class="required">*</abbr>'),t.find("label .optional").hide(),t.addClass("validate-required")):(t.find("label .required").remove(),t.find("label .optional").show(),t.removeClass("validate-required woocommerce-invalid woocommerce-invalid-required-field")),t.removeClass("hidden"),t.show()):(t.addClass("hidden"),t.hide())},getPickupLocationSelect:function(){return i("#pickup_location")},getPickupLocation:function(t,o=!0){var e=c.shipments_pickup_locations;if(e.pickupLocations.hasOwnProperty(t))return e.pickupLocations[t];if(o){var a=i("#current_pickup_location");if(a.attr("data-current-location"))try{var n=JSON.parse(a.attr("data-current-location"));if(n.code===t)return n}catch(i){}}return!1},afterRefreshCheckout:function(i,t){var o=c.shipments_pickup_locations,e=!1,a=o.pickupLocations,n=o.currentProvider;(t=void 0===t?{fragments:{".wc-shiptastic-current-provider":"",".wc-shiptastic-pickup-location-supported":!1,".wc-shiptastic-pickup-locations":JSON.stringify(o.pickupLocations)}}:t).hasOwnProperty("fragments")&&(t.fragments.hasOwnProperty(".wc-shiptastic-current-provider")&&(o.currentProvider=t.fragments[".wc-shiptastic-current-provider"]),o.currentProvider&&n===o.currentProvider||o.hasPickupLocationDelivery()&&o.disablePickupLocationDelivery(!0),t.fragments.hasOwnProperty(".wc-shiptastic-pickup-location-supported")&&(e=t.fragments[".wc-shiptastic-pickup-location-supported"]),t.fragments.hasOwnProperty(".wc-shiptastic-pickup-locations")&&(o.pickupLocations=JSON.parse(t.fragments[".wc-shiptastic-pickup-locations"]),o.updatePickupLocationSelect(a))),e?o.enable():o.disable()},disable:function(){var t=c.shipments_pickup_locations;t.available=!1,t.hasPickupLocationDelivery()&&t.disablePickupLocationDelivery(!0),i(".pickup_location_notice").addClass("hidden").hide()},enable:function(){var t=c.shipments_pickup_locations;t.available=!0,i(".pickup_location_notice").removeClass("hidden").show(),i("#ship-to-different-address-checkbox").is(":checked")||t.hasPickupLocationDelivery()?i("#billing_pickup_location_notice").addClass("hidden").hide():i("#billing_pickup_location_notice").removeClass("hidden").show()},isAvailable:function(){return c.shipments_pickup_locations.available},replaceShippingAddress:function(t){var o=c.shipments_pickup_locations,e=i("#ship-to-different-address input"),a=[];Object.keys(t).forEach((c=>{var e=t[c];if(e&&i("#shipping_"+c).length>0){i("#shipping_"+c).val()!==e&&a.push(c),i("#shipping_"+c).val(e),i("#shipping_"+c).prop("readonly",!0),"country"===c&&i("#shipping_"+c).trigger("change");var n=i("#shipping_"+c+"_field");n.length>0?(n.addClass("wc-shiptastic-managed-by-pickup-location"),n.find(".wc-shiptastic-managed-by-pickup-location-notice").length<=0&&n.find("label").after('<span class="wc-shiptastic-managed-by-pickup-location-notice">'+o.params.i18n_managed_by_pickup_location+"</span>")):i("#shipping_"+c).addClass("wc-shiptastic-managed-by-pickup-location")}})),e.is(":checked")||(e.prop("checked",!0),e.trigger("change")),a.length>0&&-1!==i.inArray("postcode",a)&&i("#shipping_postcode").trigger("change")}},i(document).ready((function(){c.shipments_pickup_locations.init()})),((window.wcShiptastic=window.wcShiptastic||{}).static=window.wcShiptastic.static||{})["pickup-locations"]={}})();