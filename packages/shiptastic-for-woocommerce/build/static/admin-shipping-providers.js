(()=>{var i,e;window.shiptastic=window.shiptastic||{},window.shiptastic.admin=window.shiptastic.admin||{},i=jQuery,(e=window.shiptastic).admin.shipping_providers={params:{},$wrapper:"",init:function(){var n=e.admin.shipping_providers;n.params=wc_shiptastic_admin_shipping_providers_params,n.$wrapper=i(".wc-stc-shipping-providers"),i(document).on("click",".wc-stc-shipping-provider-delete",n.onRemoveProvider).on("change",".wc-stc-shipping-providers input.wc-stc-shipping-provider-activated-checkbox",this.onChangeProviderStatus).on("click","a.wc-shiptastic-install-extension-btn",this.onInstallExtension),i(window).on("load",(function(){i(document).on("updateMoveButtons","table.wc-stc-shipping-providers",n.onChangeSort)})),i("table.wc-stc-shipping-providers tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,helper:function(e,n){return n.children().each((function(){i(this).width(i(this).width())})),n.css("left","0"),n},start:function(i,e){e.item.css("background-color","#f6f6f6")},stop:function(i,e){e.item.removeAttr("style"),e.item.trigger("updateMoveButtons")}})},onChangeSort:function(){var n=i(this).find('input[name="provider_order[]"]').map((function(){return i(this).val()})).get(),o=e.admin.shipping_providers,r={action:"woocommerce_stc_sort_shipping_provider",order:n,security:o.getParams().sort_shipping_provider_nonce};o.doAjax(r)},onInstallExtension:function(){var n=e.admin.shipping_providers,o=i(this),r={action:"woocommerce_stc_install_shipping_provider_extension",security:n.params.install_extension_nonce,provider_name:o.parents("tr").data("shipping-provider")};return o.addClass("wc-shiptastic-is-loading"),o.append('<span class="spinner is-active"></span>'),n.doAjax(r,n.onInstallExtensionSuccess),!1},onInstallExtensionSuccess:function(n){var o=e.admin.shipping_providers.$wrapper.find('a[data-extension="'+n.extension+'"]');if(o.find(".spinner").remove(),o.removeClass("wc-stc-is-loading"),n.success)window.location.href=n.url;else if(n.hasOwnProperty("message")){var r=i("#wpbody-content").find(".wrap");i(".wc-shiptastic-setting-tabs").length>0&&(r=i(".wc-shiptastic-setting-tabs")),r.before('<div class="error inline" id="message"><p>'+n.message+"</p></div>"),i("html, body").animate({scrollTop:i("#message").offset().top-32},1e3)}},onChangeProviderStatus:function(){var n=e.admin.shipping_providers,o=i(this),r=n.getProviderName(o),s=o.parents("td").find(".woocommerce-stc-input-toggle"),t={action:"woocommerce_stc_edit_shipping_provider_status",enable:o.is(":checked")?"yes":"no",provider:r};window.onbeforeunload="",s.addClass("woocommerce-input-toggle--loading"),n.doAjax(t,n.onChangeProviderStatusSucess)},onChangeProviderStatusSucess:function(i){var n=e.admin.shipping_providers.$wrapper.find('tr[data-shipping-provider="'+i.provider+'"]').find(".woocommerce-stc-input-toggle");n.removeClass("woocommerce-input-toggle--loading"),n.removeClass("woocommerce-input-toggle--enabled, woocommerce-input-toggle--disabled"),"yes"===i.activated?n.addClass("woocommerce-input-toggle--enabled"):n.addClass("woocommerce-input-toggle--disabled")},getProviderName:function(i){return e.admin.shipping_providers,i.data("shipping-provider")?i.data("shipping-provider"):i.parents("tr").length>0&&i.parents("tr").data("shipping-provider")},onRemoveProvider:function(){var n=e.admin.shipping_providers,o=n.getProviderName(i(this));return o&&window.confirm(n.getParams().i18n_remove_shipping_provider_notice)&&n.removeProvider(o),!1},removeProvider:function(i){var n=e.admin.shipping_providers,o={action:"woocommerce_stc_remove_shipping_provider",provider:i,security:n.getParams().remove_shipping_provider_nonce};n.block(),n.doAjax(o,n.onRemoveProviderSuccess)},onRemoveProviderSuccess:function(i){var n=e.admin.shipping_providers.$wrapper.find('tr[data-shipping-provider="'+i.provider+'"]');n.length>0&&n.remove()},block:function(){e.admin.shipping_providers.$wrapper.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){e.admin.shipping_providers.$wrapper.unblock()},doAjax:function(n,o,r){var s=e.admin.shipping_providers,t=s.params.ajax_url,a=s.$wrapper;o=o||s.onAjaxSuccess,r=r||s.onAjaxError,n.hasOwnProperty("security")||(n.security=s.params.edit_shipping_providers_nonce),i.ajax({type:"POST",url:t,data:n,success:function(i){i.success?(o.apply(a,[i]),s.unblock()):(r.apply(a,[i]),s.unblock())},error:function(i){r.apply(a,[i])},dataType:"json"})},onAjaxError:function(i){},onAjaxSuccess:function(i){},getParams:function(){return e.admin.shipping_providers.params}},i(document).ready((function(){e.admin.shipping_providers.init()})),((window.wcShiptastic=window.wcShiptastic||{}).static=window.wcShiptastic.static||{})["admin-shipping-providers"]={}})();